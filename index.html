<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Earthquake Risk Analysis Platform</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --primary: #4f46e5; /* Indigo */
        --primary-dark: #3730a3;
        --secondary: #06b6d4; /* Cyan */
        --danger: #ef4444; /* Red */
        --warning: #f59e0b; /* Amber */
        --success: #10b981; /* Green */
        --dark: #1f2937; /* Dark gray background */
        --light: #f8fafc;
        --gray: #9ca3af; /* Lighter gray for text */
        --bg-card: #111827; /* Card background dark */
        --shadow: 0 10px 40px rgba(0, 0, 0, 0.6);
        --shadow-lg: 0 20px 60px rgba(0, 0, 0, 0.8);
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Inter", sans-serif;
        background: var(--dark);
        min-height: 100vh;
        padding: 20px;
        color: var(--light);
      }

      .dashboard-container {
        max-width: 1600px;
        margin: 0 auto;
      }

      /* Header */
      .header {
        text-align: center;
        color: var(--light);
        margin-bottom: 40px;
        animation: fadeInDown 0.8s ease;
      }

      .header h1 {
        font-size: 3.5em;
        font-weight: 700;
        margin-bottom: 10px;
        text-shadow: 2px 2px 12px rgba(0, 0, 0, 0.6);
        letter-spacing: -1px;
      }

      .header p {
        font-size: 1.2em;
        opacity: 0.8;
        font-weight: 300;
      }

      /* Search Section */
      .search-section {
        background: #1e293b;
        border-radius: 20px;
        padding: 35px;
        margin-bottom: 35px;
        box-shadow: var(--shadow-lg);
        animation: fadeInUp 0.8s ease;
        color: var(--light);
      }

      .search-title {
        font-size: 1.8em;
        font-weight: 600;
        color: var(--secondary);
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .search-box {
        display: flex;
        gap: 15px;
        margin-bottom: 25px;
      }

      .search-input {
        flex: 1;
        padding: 18px 25px;
        font-size: 1.1em;
        border: 2px solid #374151;
        border-radius: 12px;
        outline: none;
        background: #111827;
        color: var(--light);
        transition: all 0.3s;
        font-family: "Inter", sans-serif;
      }

      .search-input::placeholder {
        color: #9ca3af;
      }

      .search-input:focus {
        border-color: var(--primary);
        box-shadow: 0 0 0 4px rgba(79, 70, 229, 0.2);
      }

      .search-btn {
        padding: 18px 40px;
        font-size: 1.1em;
        background: var(--primary);
        color: white;
        border: none;
        border-radius: 12px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s;
        box-shadow: 0 4px 15px rgba(79, 70, 229, 0.4);
      }

      .search-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(79, 70, 229, 0.6);
      }

      .search-btn:active {
        transform: translateY(0);
      }

      /* Search Results */
      .search-results {
        display: none;
        margin-top: 30px;
        animation: slideIn 0.4s ease;
      }

      .search-results.active {
        display: block;
      }

      .results-summary {
        background: #111827;
        color: var(--light);
        padding: 25px;
        border-radius: 15px;
        margin-bottom: 25px;
        box-shadow: var(--shadow);
      }

      .results-summary h3 {
        font-size: 1.5em;
        margin-bottom: 15px;
        color: var(--secondary);
      }

      .summary-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 20px;
        margin-top: 20px;
      }

      .summary-stat {
        background: rgba(255, 255, 255, 0.05);
        padding: 15px;
        border-radius: 10px;
        backdrop-filter: blur(8px);
      }

      .summary-stat-label {
        font-size: 0.9em;
        opacity: 0.7;
        margin-bottom: 5px;
      }

      .summary-stat-value {
        font-size: 2em;
        font-weight: 700;
        color: var(--primary);
      }

      .results-list {
        display: grid;
        gap: 15px;
      }

      .result-card {
        background: #1e293b;
        padding: 20px;
        border-radius: 12px;
        border-left: 5px solid var(--primary);
        transition: all 0.3s;
        cursor: pointer;
      }

      .result-card:hover {
        transform: translateX(5px);
        box-shadow: var(--shadow);
      }

      .result-card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 12px;
      }

      .result-location {
        font-size: 1.2em;
        font-weight: 600;
        color: var(--light);
      }

      .result-magnitude {
        padding: 8px 16px;
        border-radius: 20px;
        font-weight: 700;
        font-size: 1.1em;
      }

      .mag-critical {
        background: var(--danger);
        color: white;
      }
      .mag-high {
        background: var(--warning);
        color: white;
      }
      .mag-medium {
        background: #fbbf24;
        color: white;
      }
      .mag-low {
        background: var(--success);
        color: white;
      }

      .result-details {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
        margin-top: 15px;
        padding-top: 15px;
        border-top: 1px solid #374151;
      }

      .result-detail {
        font-size: 0.95em;
        color: #9ca3af;
      }

      .result-detail strong {
        color: var(--light);
        display: block;
        margin-bottom: 3px;
      }

      .no-results {
        text-align: center;
        padding: 60px;
        color: var(--gray);
      }

      .no-results-icon {
        font-size: 4em;
        margin-bottom: 20px;
      }

      /* Stats Grid */
      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 25px;
        margin-bottom: 35px;
      }

      .stat-card {
        background: #111827;
        padding: 30px;
        border-radius: 20px;
        box-shadow: var(--shadow);
        transition: all 0.3s;
        animation: fadeInUp 0.8s ease;
      }

      .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: var(--shadow-lg);
      }

      .stat-icon {
        font-size: 2.5em;
        margin-bottom: 15px;
      }

      .stat-value {
        font-size: 3em;
        font-weight: 700;
        color: var(--primary);
        margin-bottom: 10px;
      }

      .stat-label {
        font-size: 1.1em;
        color: var(--gray);
        font-weight: 500;
      }

      /* Map and Charts */
      .content-grid {
        display: grid;
        gap: 35px;
        margin-bottom: 35px;
      }

      .map-container {
        background: #111827;
        padding: 30px;
        border-radius: 20px;
        box-shadow: var(--shadow-lg);
        animation: fadeInUp 1s ease;
      }

      .section-title {
        font-size: 1.8em;
        font-weight: 600;
        color: var(--secondary);
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      #map {
        height: 550px;
        border-radius: 15px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
      }

      .charts-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
        gap: 35px;
      }

      .chart-container {
        background: #111827;
        padding: 30px;
        border-radius: 20px;
        box-shadow: var(--shadow);
        animation: fadeInUp 1s ease;
      }

      .chart-wrapper {
        position: relative;
        height: 350px;
      }

      /* Legend */
      .map-legend {
        background: #1e293b;
        padding: 15px;
        border-radius: 10px;
        box-shadow: var(--shadow);
        margin-top: 15px;
        color: var(--light);
      }

      .legend-title {
        font-weight: 600;
        margin-bottom: 10px;
        color: var(--secondary);
      }

      .legend-items {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 10px;
      }

      .legend-item {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 0.9em;
      }

      .legend-color {
        width: 20px;
        height: 20px;
        border-radius: 50%;
        border: 2px solid #111827;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.6);
      }

      /* Animations */
      @keyframes fadeInDown {
        from {
          opacity: 0;
          transform: translateY(-30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes slideIn {
        from {
          opacity: 0;
          max-height: 0;
        }
        to {
          opacity: 1;
          max-height: 2000px;
        }
      }

      /* Loading Spinner */
      .loading {
        text-align: center;
        padding: 40px;
        color: var(--gray);
      }

      .spinner {
        border: 4px solid #1f2937;
        border-top: 4px solid var(--primary);
        border-radius: 50%;
        width: 50px;
        height: 50px;
        animation: spin 1s linear infinite;
        margin: 0 auto 20px;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      /* Responsive */
      @media (max-width: 768px) {
        .header h1 {
          font-size: 2.2em;
        }
        .search-box {
          flex-direction: column;
        }
        .charts-grid {
          grid-template-columns: 1fr;
        }
        .stats-grid {
          grid-template-columns: 1fr;
        }
        .summary-stats {
          grid-template-columns: 1fr 1fr;
        }
      }
    </style>
  </head>
  <body>
    <div class="dashboard-container">
      <!-- Header -->
      <div class="header">
        <h1>üåç Earthquake Risk Analysis Platform</h1>
        <p>Real-time Global Seismic Activity Monitoring & Analysis</p>
      </div>

      <!-- Search Section -->
      <div class="search-section">
        <h2 class="search-title">üîç Search Earthquakes by Location</h2>
        <div class="search-box">
          <input
            type="text"
            id="searchInput"
            class="search-input"
            placeholder="Enter location (e.g., Indonesia, Japan, California, Iceland, Chile...)"
            onkeypress="if(event.key==='Enter') performSearch()"
          />
          <button class="search-btn" onclick="performSearch()">Search</button>
        </div>
        <div id="searchResults" class="search-results"></div>
      </div>

      <!-- Statistics Cards -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-icon">üìä</div>
          <div class="stat-value" id="totalEq">-</div>
          <div class="stat-label">Total Earthquakes Analyzed</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">üìà</div>
          <div class="stat-value" id="avgMag">-</div>
          <div class="stat-label">Average Magnitude</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">‚ö†Ô∏è</div>
          <div class="stat-value" id="maxMag">-</div>
          <div class="stat-label">Maximum Magnitude</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">üö®</div>
          <div class="stat-value" id="highRisk">-</div>
          <div class="stat-label">High Risk Events (‚â•7.0)</div>
        </div>
      </div>

      <!-- Map Section -->
      <div class="content-grid">
        <div class="map-container">
          <h2 class="section-title">üìç Global Earthquake Distribution Map</h2>
          <div id="map"></div>
          <div class="map-legend">
            <div class="legend-title">Magnitude Scale</div>
            <div class="legend-items">
              <div class="legend-item">
                <div class="legend-color" style="background: #10b981"></div>
                <span>Low (0-3)</span>
              </div>
              <div class="legend-item">
                <div class="legend-color" style="background: #fbbf24"></div>
                <span>Medium (3-5)</span>
              </div>
              <div class="legend-item">
                <div class="legend-color" style="background: #f59e0b"></div>
                <span>High (5-7)</span>
              </div>
              <div class="legend-item">
                <div class="legend-color" style="background: #ef4444"></div>
                <span>Critical (7+)</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Charts Section -->
      <div class="charts-grid">
        <div class="chart-container">
          <h2 class="section-title">üìä Risk Level Distribution</h2>
          <div class="chart-wrapper">
            <canvas id="riskChart"></canvas>
          </div>
        </div>
        <div class="chart-container">
          <h2 class="section-title">üìà Magnitude Trends Over Years</h2>
          <div class="chart-wrapper">
            <canvas id="trendChart"></canvas>
          </div>
        </div>
      </div>
    </div>

    <script>
      let earthquakeData = [];
      let stats = {};
      let globalMap = null;
      let mapMarkers = [];

      // Load data on page load
      window.addEventListener("DOMContentLoaded", function () {
        loadData();
      });

      async function loadData() {
        try {
          const [eqResponse, statsResponse] = await Promise.all([
            fetch("earthquake_data.json"),
            fetch("stats.json"),
          ]);

          earthquakeData = await eqResponse.json();
          stats = await statsResponse.json();

          initializeDashboard();
        } catch (error) {
          console.error("Error loading data:", error);
          alert(
            "Error: Make sure earthquake_data.json and stats.json are in the same folder as index.html"
          );
        }
      }

      function initializeDashboard() {
        updateStatistics();
        initializeMap();
        createCharts();
      }

      function updateStatistics() {
        document.getElementById("totalEq").textContent =
          stats.total.toLocaleString();
        document.getElementById("avgMag").textContent = stats.avgMag.toFixed(2);
        document.getElementById("maxMag").textContent = stats.maxMag.toFixed(1);
        document.getElementById("highRisk").textContent =
          stats.highRisk.toLocaleString();
      }

      function initializeMap() {
        globalMap = L.map("map").setView([20, 0], 2);

        L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
          attribution: "¬© OpenStreetMap contributors",
          maxZoom: 18,
        }).addTo(globalMap);

        earthquakeData.forEach((eq) => {
          const color =
            eq.magnitude >= 7
              ? "#ef4444"
              : eq.magnitude >= 5
              ? "#f59e0b"
              : eq.magnitude >= 3
              ? "#fbbf24"
              : "#10b981";

          const marker = L.circleMarker([eq.lat, eq.lng], {
            radius: Math.max(eq.magnitude * 1.5, 3),
            fillColor: color,
            color: "#ffffff",
            weight: 2,
            opacity: 1,
            fillOpacity: 0.7,
          })
            .bindPopup(
              `
                    <div style="font-family: Inter, sans-serif;">
                        <strong style="font-size: 1.1em; color: #1e293b;">${
                          eq.location
                        }</strong><br><br>
                        <strong>Magnitude:</strong> ${eq.magnitude}<br>
                        <strong>Depth:</strong> ${eq.depth} km<br>
                        <strong>Risk Level:</strong> ${eq.risk}<br>
                        <strong>Coordinates:</strong> ${eq.lat.toFixed(
                          3
                        )}, ${eq.lng.toFixed(3)}
                    </div>
                `
            )
            .addTo(globalMap);

          mapMarkers.push(marker);
        });
      }

      function createCharts() {
        // Risk Distribution Chart
        const riskCtx = document.getElementById("riskChart").getContext("2d");
        new Chart(riskCtx, {
          type: "doughnut",
          data: {
            labels: ["Low Risk", "Medium Risk", "High Risk", "Critical Risk"],
            datasets: [
              {
                data: [
                  stats.riskDist.Low,
                  stats.riskDist.Medium,
                  stats.riskDist.High,
                  stats.riskDist.Critical,
                ],
                backgroundColor: ["#10b981", "#fbbf24", "#f59e0b", "#ef4444"],
                borderWidth: 3,
                borderColor: "#ffffff",
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: "bottom",
                labels: {
                  padding: 20,
                  font: { size: 13, family: "Inter" },
                },
              },
              tooltip: {
                callbacks: {
                  label: function (context) {
                    const label = context.label || "";
                    const value = context.parsed || 0;
                    const total = context.dataset.data.reduce(
                      (a, b) => a + b,
                      0
                    );
                    const percentage = ((value / total) * 100).toFixed(1);
                    return `${label}: ${value.toLocaleString()} (${percentage}%)`;
                  },
                },
              },
            },
          },
        });

        // Trend Chart
        const years = Object.keys(stats.yearlyAvg).sort();
        const avgMags = years.map((y) => stats.yearlyAvg[y]);

        const trendCtx = document.getElementById("trendChart").getContext("2d");
        new Chart(trendCtx, {
          type: "line",
          data: {
            labels: years,
            datasets: [
              {
                label: "Average Magnitude",
                data: avgMags,
                borderColor: "#4f46e5",
                backgroundColor: "rgba(79, 70, 229, 0.1)",
                tension: 0.4,
                fill: true,
                borderWidth: 3,
                pointRadius: 5,
                pointBackgroundColor: "#4f46e5",
                pointBorderColor: "#ffffff",
                pointBorderWidth: 2,
                pointHoverRadius: 7,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: true,
                position: "top",
                labels: {
                  font: { size: 13, family: "Inter" },
                },
              },
            },
            scales: {
              y: {
                beginAtZero: false,
                grid: { color: "#e2e8f0" },
                ticks: { font: { family: "Inter" } },
              },
              x: {
                grid: { display: false },
                ticks: { font: { family: "Inter" } },
              },
            },
          },
        });
      }

      function performSearch() {
        const searchTerm = document
          .getElementById("searchInput")
          .value.trim()
          .toLowerCase();
        const resultsDiv = document.getElementById("searchResults");

        if (!searchTerm) {
          resultsDiv.classList.remove("active");
          return;
        }

        const results = earthquakeData.filter(
          (eq) => eq.location && eq.location.toLowerCase().includes(searchTerm)
        );

        if (results.length === 0) {
          resultsDiv.innerHTML = `
                    <div class="no-results">
                        <div class="no-results-icon">üîç</div>
                        <h3>No earthquakes found for "${searchTerm}"</h3>
                        <p>Try searching: Indonesia, Japan, California, Iceland, Chile, Mexico, Turkey, etc.</p>
                    </div>
                `;
        } else {
          results.sort((a, b) => b.magnitude - a.magnitude);

          const avgMag = (
            results.reduce((sum, eq) => sum + eq.magnitude, 0) / results.length
          ).toFixed(2);
          const maxMag = Math.max(...results.map((eq) => eq.magnitude)).toFixed(
            2
          );
          const minMag = Math.min(...results.map((eq) => eq.magnitude)).toFixed(
            2
          );
          const criticalCount = results.filter(
            (eq) => eq.magnitude >= 7
          ).length;
          const highCount = results.filter(
            (eq) => eq.magnitude >= 5 && eq.magnitude < 7
          ).length;
          const avgDepth = (
            results.reduce((sum, eq) => sum + eq.depth, 0) / results.length
          ).toFixed(1);

          let html = `
                    <div class="results-summary">
                        <h3>üìç Found ${results.length} earthquake(s) in "${searchTerm}"</h3>
                        <div class="summary-stats">
                            <div class="summary-stat">
                                <div class="summary-stat-label">Average Magnitude</div>
                                <div class="summary-stat-value">${avgMag}</div>
                            </div>
                            <div class="summary-stat">
                                <div class="summary-stat-label">Max Magnitude</div>
                                <div class="summary-stat-value">${maxMag}</div>
                            </div>
                            <div class="summary-stat">
                                <div class="summary-stat-label">Min Magnitude</div>
                                <div class="summary-stat-value">${minMag}</div>
                            </div>
                            <div class="summary-stat">
                                <div class="summary-stat-label">Critical (‚â•7.0)</div>
                                <div class="summary-stat-value">${criticalCount}</div>
                            </div>
                            <div class="summary-stat">
                                <div class="summary-stat-label">High Risk (5-7)</div>
                                <div class="summary-stat-value">${highCount}</div>
                            </div>
                            <div class="summary-stat">
                                <div class="summary-stat-label">Avg Depth (km)</div>
                                <div class="summary-stat-value">${avgDepth}</div>
                            </div>
                        </div>
                    </div>
                    <div class="results-list">
                `;

          results.forEach((eq, index) => {
            const magClass =
              eq.magnitude >= 7
                ? "mag-critical"
                : eq.magnitude >= 5
                ? "mag-high"
                : eq.magnitude >= 3
                ? "mag-medium"
                : "mag-low";

            html += `
                        <div class="result-card" onclick="focusOnLocation(${
                          eq.lat
                        }, ${eq.lng})">
                            <div class="result-card-header">
                                <div class="result-location">${index + 1}. ${
              eq.location
            }</div>
                                <div class="result-magnitude ${magClass}">M ${
              eq.magnitude
            }</div>
                            </div>
                            <div class="result-details">
                                <div class="result-detail">
                                    <strong>Depth</strong>
                                    ${eq.depth} km
                                </div>
                                <div class="result-detail">
                                    <strong>Risk Level</strong>
                                    ${eq.risk}
                                </div>
                                <div class="result-detail">
                                    <strong>Coordinates</strong>
                                    ${eq.lat.toFixed(3)}¬∞, ${eq.lng.toFixed(3)}¬∞
                                </div>
                            </div>
                        </div>
                    `;
          });

          html += "</div>";
          resultsDiv.innerHTML = html;
        }

        resultsDiv.classList.add("active");
        resultsDiv.scrollIntoView({ behavior: "smooth", block: "nearest" });
      }

      function focusOnLocation(lat, lng) {
        if (globalMap) {
          globalMap.setView([lat, lng], 8);

          L.popup()
            .setLatLng([lat, lng])
            .setContent("<strong>üéØ Selected Location</strong>")
            .openOn(globalMap);

          document.querySelector(".map-container").scrollIntoView({
            behavior: "smooth",
            block: "center",
          });
        }
      }
    </script>
  </body>
</html>
